{%- liquid
  assign section_st = section.settings
  assign section_width = section_st.section_width
  assign color_scheme = section_st.color_scheme
  assign reset_spacing = ''
  if section_st.reset_spacing
    assign reset_spacing = ' remove_spacing'
  endif
-%}

{%- capture style -%}
  --section-pt: {{ section_st.padding_top }}px; 
  --section-pb: {{ section_st.padding_bottom }}px;
  --speed: {{ section_st.speed }}s; 
  --image-width: {{ section_st.image_width }}px;
  --col-gap: {{ section_st.space_between_images }}px;
{%- endcapture -%}

<div
  class="section{% if section_st.padding_top < 30 %} pt-min{% endif %}{% if section_st.padding_bottom < 30 %} pb-min{% endif %} sec__scrolling-text color-{{ color_scheme }} gradient{{ reset_spacing }}"
  style="{{ style | strip | strip_newlines }}"
>
  <div class="{{ section_width }}">
    <div
      class="marquee"
      {% if section_st.direction == 'right' %}
        data-direction="right"
      {% endif %}
    >
      {%- comment -%} 
        Duplicamos el contenido varias veces para asegurar loop infinito
      {%- endcomment -%}
      {%- for i in (0..9) -%}
        <div class="animation-marquee {% if section_st.direction == 'right' %}reverse{% endif %}">
          {%- for block in section.blocks -%}
            {% assign block_st = block.settings %}
            
            <div class="marquee__item-image" {{ block.shopify_attributes }}>
              
              {%- if block_st.link != blank -%}
                <a href="{{ block_st.link }}" class="marquee__link">
              {%- endif -%}

              {%- if block_st.image != blank -%}
                {{
                  block_st.image
                  | image_url: width: 600
                  | image_tag:
                    loading: 'eager',
                    class: 'marquee-image',
                    widths: '200, 300, 400, 600',
                    alt: block_st.image.alt | default: 'Brand logo'
                }}
              {%- else -%}
                {{ 'image' | placeholder_svg_tag: 'placeholder-svg marquee-image' }}
              {%- endif -%}

              {%- if block_st.link != blank -%}
                </a>
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

<style>
  /* 1. Configuración de la sección */
  .sec__scrolling-text {
    padding-top: var(--section-pt);
    padding-bottom: var(--section-pb);
    overflow: hidden;
    width: 100%;
    display: block;
  }

  /* 2. El contenedor oculto que evita el scroll horizontal de la página */
  .marquee {
    display: flex;
    width: 100%;
    overflow: hidden;
    white-space: nowrap;
    user-select: none;
    gap: var(--col-gap); /* Espacio entre los grupos repetidos */
  }

  /* 3. La pista que se mueve (Track) */
  .animation-marquee {
    display: flex;
    flex-shrink: 0;
    align-items: center;
    justify-content: space-around;
    gap: var(--col-gap); /* Espacio entre logos individuales */
    
    /* LA MAGIA: La animación */
    animation: scrolling-left var(--speed) linear infinite;
  }

  /* Control de Dirección Derecha */
  .animation-marquee.reverse {
    animation-direction: reverse;
  }

  /* Pausar al pasar el mouse (opcional) */
  .marquee:hover .animation-marquee {
    animation-play-state: paused;
  }

  /* 4. Estilos de los Items (Logos) */
  .marquee__item-image {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--image-width); 
    min-width: var(--image-width); 
  }

  .marquee__link {
    display: flex;
    width: 100%;
    height: 100%;
    align-items: center;
    justify-content: center;
  }
  
  .marquee-image {
    width: 100%;
    height: auto;
    max-height: 100px; /* Control de altura máxima */
    object-fit: contain;
    display: block;
  }

  /* SVG Placeholder */
  svg.marquee-image {
    background-color: rgba(0,0,0,0.05);
    padding: 15px;
    height: 80px;
    width: 100%;
  }

  /* 5. DEFINICIÓN DE KEYFRAMES (Esencial para que se mueva) */
  @keyframes scrolling-left {
    0% {
      transform: translateX(0);
    }
    100% {
      /* Se mueve hacia la izquierda el 100% de su propio tamaño + el gap */
      transform: translateX(calc(-100% - var(--col-gap)));
    }
  }
</style>

{% schema %}
{
  "name": "Logo Marquee Slider",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer", "custom.overlay"]
  },
  "settings": [
    {
      "type": "select",
      "id": "section_width",
      "label": "t:sections.all.section_width.label",
      "default": "full_width",
      "options": [
        { "value": "container", "label": "Container" },
        { "value": "fluid_container", "label": "Fluid container" },
        { "value": "stretch_width", "label": "Stretch width" },
        { "value": "full_width", "label": "Full width" }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Marquee Settings"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Direction",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "range",
      "id": "speed",
      "label": "Speed",
      "info": "Lower is faster",
      "default": 10,
      "min": 2,
      "max": 60,
      "step": 1,
      "unit": "s"
    },
    {
      "type": "header",
      "content": "Image Configuration"
    },
    {
      "type": "range",
      "id": "image_width",
      "label": "Image Width (Container)",
      "info": "Controls the reserved width for each logo",
      "default": 130,
      "min": 50,
      "max": 300,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "space_between_images",
      "label": "Space between images",
      "default": 50,
      "min": 0,
      "max": 300,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "default": 20,
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "default": 20,
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "reset_spacing",
      "label": "Remove default section spacing",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Image / Logo",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image (PNG/JPG)"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (Optional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Logo Marquee Slider",
      "blocks": [
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" }
      ]
    }
  ]
}
{% endschema %}